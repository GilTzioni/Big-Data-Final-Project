<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.0.js"></script>

  <link rel="stylesheet" href="../assets/stylesheets/styleDashboard.css"/>

  <a class="b2" href="/flights" role="link"><div class="textb2">טיסות ממתינות להמראה </div></bar><div class="numFlight" id="numFlight"></div></a>   
  
  <a class="b1" href="/landings" role="link"><div class="textb1">טיסות ממתינות לנחיתה </div></bar><div class="numLanding" id="numLanding"></div></a>
  
  <div id="b3">
    <link rel="stylesheet" href="../assets/font/Rimouski.css">
     <link rel="stylesheet" href="../assets/stylesheets/styleWeather.css">
     <div class="container">
      
      <div class="notification"> </div>
      <div class="weather-container">
          <div class="weather-icon">
              <img src="../assets/icons/unknown.png" alt=""> </div>
          <div class="temperature-description">
              <p> - </p>
          <div class="location">
              <p>-</p>
          </div>
        
         
          </div>
          <div class="temperature-value">
              <p>- °<span>C</span></p>
          </div>
         
         
      </div>
  </div>
  
  <script type='text/javascript'>
    // api key : 82005d27a116c2880c8f0fcb866998a0

// SELECT ELEMENTS
const iconElement = document.querySelector(".weather-icon");
const tempElement = document.querySelector(".temperature-value p");
const descElement = document.querySelector(".temperature-description p");
const locationElement = document.querySelector(".location p");
const notificationElement = document.querySelector(".notification");

// App data
const weather = {};

weather.temperature = {
    unit : "celsius"
}

// APP CONSTS AND VARS
const KELVIN = 273;
// API KEY
const key = "82005d27a116c2880c8f0fcb866998a0";

// CHECK IF BROWSER SUPPORTS GEOLOCATION
if('geolocation' in navigator){
    navigator.geolocation.getCurrentPosition(setPosition, showError);
}else{
    notificationElement.style.display = "block";
    notificationElement.innerHTML = "<p>Browser doesn't Support Geolocation</p>";
}

// SET USER'S POSITION
function setPosition(position){
    let latitude = position.coords.latitude;
    let longitude = position.coords.longitude;
    
    getWeather(latitude, longitude);
}

// SHOW ERROR WHEN THERE IS AN ISSUE WITH GEOLOCATION SERVICE
function showError(error){
    notificationElement.style.display = "block";
    notificationElement.innerHTML = `<p> ${error.message} </p>`;
}

// GET WEATHER FROM API PROVIDER
function getWeather(latitude, longitude){
    let api = `http://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${key}`;
    
    fetch(api)
        .then(function(response){
            let data = response.json();
            return data;
        })
        .then(function(data){
            weather.temperature.value = Math.floor(data.main.temp - KELVIN);
            weather.description = data.weather[0].description;
            weather.iconId = data.weather[0].icon;
            weather.city = data.name;
            weather.country = data.sys.country;
        })
        .then(function(){
            displayWeather();
        });
}

// DISPLAY WEATHER TO UI
function displayWeather(){
    iconElement.innerHTML = `<img src="icons/${weather.iconId}.png"/>`;
    tempElement.innerHTML = `${weather.temperature.value}°<span>C</span>`;
    descElement.innerHTML = weather.description;
    locationElement.innerHTML = `${weather.city}, ${weather.country}`;
}

// C to F conversion
function celsiusToFahrenheit(temperature){
    return (temperature * 9/5) + 32;
}

// WHEN THE USER CLICKS ON THE TEMPERATURE ELEMENET
tempElement.addEventListener("click", function(){
    if(weather.temperature.value === undefined) return;
    
    if(weather.temperature.unit == "celsius"){
        let fahrenheit = celsiusToFahrenheit(weather.temperature.value);
        fahrenheit = Math.floor(fahrenheit);
        
        tempElement.innerHTML = `${fahrenheit}°<span>F</span>`;
        weather.temperature.unit = "fahrenheit";
    }else{
        tempElement.innerHTML = `${weather.temperature.value}°<span>C</span>`;
        weather.temperature.unit = "celsius"
    }
});
  </script>
</div>
 
<script type="text/javascript">
    var map = null;
    function setMap() {
        map = new Microsoft.Maps.Map(document.getElementById("myMap"), { credentials: "AlKPvaFLRlENPR8sZ4FW3dgnTZ1wI2vL09O0j4VW574mAWA16ph-fzxr0KLTNWL1" });

    }
</script>

<script type='text/javascript'>
    function add()
    {
        var loc1 = new Microsoft.Maps.Location(37.983810,23.727539);
        var loc2 = new Microsoft.Maps.Location(32.817280,34.988762);
        var loc3 = new Microsoft.Maps.Location(30.044420, 31.235712);
        var loc4 = new Microsoft.Maps.Location(35.0, 30.0);
      
        // Add a pin to the map
        var pin1 = new Microsoft.Maps.Pushpin(loc1, {
           icon:"../assets/icons/airplane.png",
            anchor: new Microsoft.Maps.Point(10, 10)
        });
        var pin2 = new Microsoft.Maps.Pushpin(loc2, {
           icon:"../assets/icons/airplane_down.png",
            anchor: new Microsoft.Maps.Point(10, 10)
        });
        var pin3 = new Microsoft.Maps.Pushpin(loc3, {
            
           icon:"../assets/icons/airplane_left.png",
            anchor: new Microsoft.Maps.Point(10, 10)
        });
        
        pin4 = new Microsoft.Maps.Pushpin(loc4, {
            icon:"../assets/icons/airplane_right.png",
            anchor: new Microsoft.Maps.Point(10, 10)
        });
      
        map.setView({ center: loc2, zoom: 4 });

       //  map.entities.push(line);
        map.entities.push(pin1);
        map.entities.push(pin2);
        map.entities.push(pin3);
        map.entities.push(pin4);
       

    }
    function move() {
        for (var i = map.entities.getLength() - 1; i >= 0; i--) {
            var pushpin = map.entities.get(i);
            if (pushpin instanceof Microsoft.Maps.Pushpin) {
                map.entities.removeAt(i);
            }
        }
    }       
   
</script>

<script language="JavaScript">
          
    function clockBlock() {

          var timeNow=new Date();

           var hrs=timeNow.getHours();
           var min=timeNow.getMinutes();
           var sec=timeNow.getSeconds();
           var amPm="AM";

           if (hrs==0) {
                  hrs=12;
           }
           if (hrs>12) {
                   amPm="PM";
                   hrs=hrs-12;
           }
           if (hrs<10) {
                   hrs="0"+hrs;
           }
           if (min<10) {
                   min="0"+min;
           }
           if (sec<10) {
                   sec="0"+sec;
           }

          var printClock=document.getElementById('clockDisplay');
          printClock.textContent=hrs+":"+min+":"+sec+" "+amPm;
          printClock.innerText=hrs+":"+min+":"+":"+sec+" "+amPm;

           setTimeout('clockBlock()',1000);

    } 
    </script>

    <script type="text/javascript">
        var flights = {};
        var landings = {};
        let numFlight = 0;
        let numLanding = 0;
        var map = null;
        
        function initSocket() {
            //socket is global
            socket = io.connect();
            alert("connected");
            setMap();
            clockBlock();
            startTime();
            flights = {};
            landings = {};
            numFlight = 0;
            numLanding = 0;
            const flight = (x, y, z) => {
                let length = x;
                let width = y;
                let degrees = z;
                let fly = { length, width, degrees };
                return fly;
            }
            socket.on('newFlights', function (msg) {
                console.log(msg.direction);
                let flight = flight(msg.numFlight,msg.from,msg.to,msg.length, msg.width, msg.degrees);
                if (msg.direction==0){
                    flights[numFlight++] = flight;
                }
                else{
                    landings[numLanding++] = flight;
                }
                document.getElementById('numFlight').innerHTML = numFlight;
                document.getElementById('numLanding').innerHTML = numLanding;
                //console.log(counter);
            });
            socket.on('allData', function (msg) {
               
            });
        }
        function resetInfo() {
            socket.emit('resetDB');
        }
    </script>
</head>

<body onLoad="initSocket()">
    <input id="badd" type="button" onclick="add()" value="הוסף אייקונים" />
    <input id="bremove" type="button" onclick="move()" value="הסר אייקונים" />
    <div id="myMap"></div>
    <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=AlKPvaFLRlENPR8sZ4FW3dgnTZ1wI2vL09O0j4VW574mAWA16ph-fzxr0KLTNWL1' async defer></script> 
    <div id="clockDisplay" class="clockDesign" dir="ltr"><br/></div>
</body>